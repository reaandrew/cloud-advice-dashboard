{% extends "template.njk" %}

{% block pageTitle %}{{ serviceName }}{% endblock %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">{{ serviceName }}</h1>

        <p class="govuk-body-l">
            Welcome to the Cloud Advice Dashboard. This application provides insights into your cloud infrastructure compliance and policy management.
        </p>

        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">
                    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
                        {% set nonCompliantCount = 0 %}
                        {% for stat in globalStats %}
                            {% if stat.status == "Non Compliant" %}{% set nonCompliantCount = nonCompliantCount + 1 %}{% endif %}
                        {% endfor %}

                        <div style="background: #f3f2f1; padding: 20px; flex: 1; border-left: 10px solid var(--app-primary-green);">
                            <span class="govuk-caption-m">Total Rules</span>
                            <h2 class="govuk-heading-l govuk-!-margin-bottom-0">{{ globalStats.length }}</h2>
                        </div>
                        <div style="background: #f3f2f1; padding: 20px; flex: 1; border-left: 10px solid var(--app-tertiary-red);">
                            <span class="govuk-caption-m">Rules Failing Target</span>
                            <h2 class="govuk-heading-l govuk-!-margin-bottom-0">{{ nonCompliantCount }}</h2>
                        </div>
                    </div>
                </div>
            </div>

            <table class="govuk-table">
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th class="govuk-table__header">Rule</th>
                        <th class="govuk-table__header">Compliance Score</th>
                        <th class="govuk-table__header">Status</th>
                        <th class="govuk-table__header">Resources</th>
                        <th class="govuk-table__header">Action</th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                    {% for stat in globalStats %}
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell">
                            <strong class="govuk-body-s">{{ stat.ruleName }}</strong><br>
                            <span class="govuk-hint govuk-!-font-size-14">{{ stat.ruleId }}</span>
                        </td>
                        <td class="govuk-table__cell">
                            <span class="govuk-body-m" style="font-weight: bold;">{{ stat.percentage }}%</span>
                            <span class="govuk-hint govuk-!-font-size-14"> / Target {{ stat.threshold }}%</span>
                        </td>
                        <td class="govuk-table__cell">
                            <strong class="govuk-tag" style="background: var({{ stat.colorVar }}); color: white;">
                                {{ stat.status }}
                            </strong>
                        </td>
                        <td class="govuk-table__cell">
                            {{ stat.compliantCount }} / {{ stat.count }}
                        </td>
                        <td class="govuk-table__cell">
                            <a href="/compliance/rule/{{ stat.ruleId }}" class="govuk-link">View Details</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
</div>
{% endblock %}
