{% extends "template.njk" %}

{% block content %}
<div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
        <h1 class="govuk-heading-xl">Cloud Advice Dashboard</h1>
        
        <p class="govuk-body-l">
            Welcome to the Cloud Advice Dashboard. This application provides insights into your cloud infrastructure compliance and policy management.
        </p>

        {% if dashboardMetrics %}
          <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">
              <h2 class="govuk-heading-l">Compliance Overview</h2>
              {% if dashboardMetrics.date %}
                <p class="govuk-body-s govuk-!-margin-bottom-6">Data as of {{ dashboardMetrics.date }}</p>
              {% endif %}
            </div>
          </div>
          
          <!-- Dashboard metrics grid -->
          <div class="govuk-grid-row govuk-!-margin-bottom-6" style="display: flex; flex-wrap: wrap;">
            <!-- Overall Compliance -->
            <div class="govuk-grid-column-one-quarter">
              <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                  <h2 class="govuk-summary-card__title">Overall Compliance</h2>
                </div>
                <div class="govuk-summary-card__content">
                  <div style="text-align: center; padding: 20px;">
                    <div class="govuk-heading-xl govuk-!-margin-bottom-2" style="color: var(--app-primary-green);">{{ dashboardMetrics.overallCompliance }}%</div>
                    <p class="govuk-body-s govuk-!-margin-bottom-0">Resources with all mandatory tags</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Secure Load Balancers -->
            <div class="govuk-grid-column-one-quarter">
              <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                  <h2 class="govuk-summary-card__title">Secure Load Balancers</h2>
                </div>
                <div class="govuk-summary-card__content">
                  <div style="text-align: center; padding: 20px;">
                    <div class="govuk-heading-xl govuk-!-margin-bottom-2" style="color: var(--app-primary-green);">{{ dashboardMetrics.secureLoadBalancers }}%</div>
                    <p class="govuk-body-s govuk-!-margin-bottom-0">Load balancers with HTTPS/TLS</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Current DB Versions -->
            <div class="govuk-grid-column-one-quarter">
              <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                  <h2 class="govuk-summary-card__title">Current DB Versions</h2>
                </div>
                <div class="govuk-summary-card__content">
                  <div style="text-align: center; padding: 20px;">
                    <div class="govuk-heading-xl govuk-!-margin-bottom-2" style="color: var(--app-primary-green);">{{ dashboardMetrics.currentDbVersions }}%</div>
                    <p class="govuk-body-s govuk-!-margin-bottom-0">Databases on supported versions</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- KMS Keys with Rotation -->
            <div class="govuk-grid-column-one-quarter">
              <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                  <h2 class="govuk-summary-card__title">KMS Key Rotation</h2>
                </div>
                <div class="govuk-summary-card__content">
                  <div style="text-align: center; padding: 20px;">
                    <div class="govuk-heading-xl govuk-!-margin-bottom-2" style="color: var(--app-primary-green);">{{ dashboardMetrics.kmsKeysWithRotation }}%</div>
                    <p class="govuk-body-s govuk-!-margin-bottom-0">Keys with rotation enabled</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="govuk-grid-row govuk-!-margin-bottom-6" style="display: flex; flex-wrap: wrap;">
            <!-- Active ALBs -->
            <div class="govuk-grid-column-one-quarter">
              <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                  <h2 class="govuk-summary-card__title">Active ALBs</h2>
                </div>
                <div class="govuk-summary-card__content">
                  <div style="text-align: center; padding: 20px;">
                    <div class="govuk-heading-xl govuk-!-margin-bottom-2" style="color: var(--app-primary-green);">{{ dashboardMetrics.activeAlbs }}%</div>
                    <p class="govuk-body-s govuk-!-margin-bottom-0">Application Load Balancers in active state</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Correctly Configured ALBs -->
            <div class="govuk-grid-column-one-quarter">
              <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                  <h2 class="govuk-summary-card__title">Correct ALB Config</h2>
                </div>
                <div class="govuk-summary-card__content">
                  <div style="text-align: center; padding: 20px;">
                    <div class="govuk-heading-xl govuk-!-margin-bottom-2" style="color: var(--app-primary-green);">{{ dashboardMetrics.correctlyConfiguredAlbs }}%</div>
                    <p class="govuk-body-s govuk-!-margin-bottom-0">Internet-facing ALBs with HTTPS</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Modern Load Balancers -->
            <div class="govuk-grid-column-one-quarter">
              <div class="govuk-summary-card">
                <div class="govuk-summary-card__title-wrapper">
                  <h2 class="govuk-summary-card__title">Modern Load Balancers</h2>
                </div>
                <div class="govuk-summary-card__content">
                  <div style="text-align: center; padding: 20px;">
                    <div class="govuk-heading-xl govuk-!-margin-bottom-2" style="color: var(--app-primary-green);">{{ dashboardMetrics.modernLbs }}%</div>
                    <p class="govuk-body-s govuk-!-margin-bottom-0">Using ALB/NLB instead of Classic ELB</p>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Placeholder for future metric -->
            <div class="govuk-grid-column-one-quarter">
              <!-- Empty column for alignment -->
            </div>
          </div>
          
          <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
        {% else %}
          <div class="govuk-warning-text">
            <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
            <strong class="govuk-warning-text__text">
              <span class="govuk-warning-text__assistive">Warning</span>
              Dashboard metrics are currently unavailable. Please check back later.
            </strong>
          </div>
        {% endif %}

        <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-half">
                <div class="govuk-panel govuk-panel--confirmation">
                    <h2 class="govuk-panel__title">
                        <a href="/compliance" class="govuk-link govuk-link--no-visited-state" style="color: inherit; text-decoration: none;">
                            Reports
                        </a>
                    </h2>
                    <div class="govuk-panel__body">
                        View compliance reports and audit findings for your cloud resources.
                    </div>
                </div>
            </div>

            <div class="govuk-grid-column-one-half">
                <div class="govuk-panel govuk-panel--confirmation">
                    <h2 class="govuk-panel__title">
                        <a href="/policies" class="govuk-link govuk-link--no-visited-state" style="color: inherit; text-decoration: none;">
                            Policies
                        </a>
                    </h2>
                    <div class="govuk-panel__body">
                        Access policy documents and governance guidelines.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}