{% extends "template.njk" %}
 
{% block content %}
    <div class="app-width-container">
        {% from "govuk/components/breadcrumbs/macro.njk" import govukBreadcrumbs %}
        {{ govukBreadcrumbs({ items: breadcrumbs }) }}
    </div>
 
  <div class="app-width-container">
    <main class="govuk-main-wrapper" id="main-content" role="main">
      <div class="govuk-grid-row">
        <!-- Left-hand Navigation -->
        <div class="govuk-grid-column-one-third">
          <div class="app-split-pane__nav">
            <button class="app-mobile-menu-toggle govuk-button govuk-button--secondary"
                    data-module="mobile-menu-toggle"
                    aria-expanded="false"
                    aria-controls="compliance-mobile-menu">
              Menu
              <span class="app-mobile-menu-toggle__icon"></span>
            </button>
            <nav class="app-subnav" id="compliance-mobile-menu" aria-labelledby="app-subnav-heading">
              <h2 class="govuk-visually-hidden" id="app-subnav-heading">Pages in this section</h2>
              {% for section in navigationSections %}
                <h3 class="app-subnav__theme govuk-heading-m">{{ section.title }}</h3>
                <ul class="govuk-list govuk-list--spaced">
                  {% for item in section.items %}
                    <li>
                      <a class="govuk-link" href="{{ item.href }}">{{ item.text }}</a>
                    </li>
                  {% endfor %}
                </ul>
              {% endfor %}
            </nav>
          </div>
        </div>
 
        <!-- Main content -->
        <div class="govuk-grid-column-two-thirds">
          <h1 class="govuk-heading-l">Compliance Dashboard</h1>

          {% if overview %}
            {# Summary Counts Section #}
            <h2 class="govuk-heading-m">Summary</h2>
            <div class="govuk-grid-row">
              <div class="govuk-grid-column-one-third">
                <div class="govuk-panel" style="background-color: #f3f2f1; padding: 20px; text-align: center;">
                  <h3 class="govuk-heading-s" style="margin-bottom: 10px;">Accounts</h3>
                  <p class="govuk-heading-l" style="margin: 0;">{{ overview.counts.accounts }}</p>
                </div>
              </div>
              <div class="govuk-grid-column-one-third">
                <div class="govuk-panel" style="background-color: #f3f2f1; padding: 20px; text-align: center;">
                  <h3 class="govuk-heading-s" style="margin-bottom: 10px;">Teams</h3>
                  <p class="govuk-heading-l" style="margin: 0;">
                    <a href="/compliance/teams" class="govuk-link">{{ overview.counts.teams }}</a>
                  </p>
                </div>
              </div>
              <div class="govuk-grid-column-one-third">
                <div class="govuk-panel" style="background-color: #f3f2f1; padding: 20px; text-align: center;">
                  <h3 class="govuk-heading-s" style="margin-bottom: 10px;">Tenants</h3>
                  <p class="govuk-heading-l" style="margin: 0;">
                    <a href="/compliance/tenants" class="govuk-link">{{ overview.counts.tenants }}</a>
                  </p>
                </div>
              </div>
            </div>

            {# Compliance Status Table #}
            <h2 class="govuk-heading-m" style="margin-top: 40px;">Compliance Status by Resource Type</h2>
            <p class="govuk-body">Non-compliant teams and tenants with issues in each compliance area.</p>

            <table class="govuk-table">
              <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                  <th class="govuk-table__header" style="width: 40%">Resource Type</th>
                  <th class="govuk-table__header govuk-table__header--numeric">Non-Compliant Teams</th>
                  <th class="govuk-table__header govuk-table__header--numeric">Non-Compliant Tenants</th>
                </tr>
              </thead>
              <tbody class="govuk-table__body">
                {% for resourceType in overview.resourceTypes %}
                <tr class="govuk-table__row">
                  <td class="govuk-table__cell"><strong>{{ resourceType.name }}</strong></td>
                  <td class="govuk-table__cell govuk-table__cell--numeric"{% if resourceType.teamsNonCompliant == 0 %} style="background-color: #f0f9f0;"{% elif resourceType.teamsNonCompliant > 0 %} style="background-color: #fef2f2;"{% endif %}>
                    {% if resourceType.teamsNonCompliant > 0 %}
                      {% if resourceType.name == 'Tagging' %}
                        <a href="/compliance/teams#tagging" class="govuk-link">{{ resourceType.teamsNonCompliant }}</a>
                      {% elif resourceType.name == 'Database' %}
                        <a href="/compliance/teams#database" class="govuk-link">{{ resourceType.teamsNonCompliant }}</a>
                      {% elif resourceType.name == 'Load Balancers' %}
                        <a href="/compliance/teams#loadbalancers" class="govuk-link">{{ resourceType.teamsNonCompliant }}</a>
                      {% elif resourceType.name == 'KMS Keys' %}
                        <a href="/compliance/teams#kms" class="govuk-link">{{ resourceType.teamsNonCompliant }}</a>
                      {% elif resourceType.name == 'Auto Scaling' %}
                        <a href="/compliance/teams#autoscaling" class="govuk-link">{{ resourceType.teamsNonCompliant }}</a>
                      {% else %}
                        {{ resourceType.teamsNonCompliant }}
                      {% endif %}
                    {% else %}
                      {{ resourceType.teamsNonCompliant }}
                    {% endif %}
                  </td>
                  <td class="govuk-table__cell govuk-table__cell--numeric"{% if resourceType.tenantsNonCompliant == 0 %} style="background-color: #f0f9f0;"{% elif resourceType.tenantsNonCompliant > 0 %} style="background-color: #fef2f2;"{% endif %}>
                    {% if resourceType.tenantsNonCompliant > 0 %}
                      {% if resourceType.name == 'Tagging' %}
                        <a href="/compliance/tenants#tagging" class="govuk-link">{{ resourceType.tenantsNonCompliant }}</a>
                      {% elif resourceType.name == 'Database' %}
                        <a href="/compliance/tenants#database" class="govuk-link">{{ resourceType.tenantsNonCompliant }}</a>
                      {% elif resourceType.name == 'Load Balancers' %}
                        <a href="/compliance/tenants#loadbalancers" class="govuk-link">{{ resourceType.tenantsNonCompliant }}</a>
                      {% elif resourceType.name == 'KMS Keys' %}
                        <a href="/compliance/tenants#kms" class="govuk-link">{{ resourceType.tenantsNonCompliant }}</a>
                      {% elif resourceType.name == 'Auto Scaling' %}
                        <a href="/compliance/tenants#autoscaling" class="govuk-link">{{ resourceType.tenantsNonCompliant }}</a>
                      {% else %}
                        {{ resourceType.tenantsNonCompliant }}
                      {% endif %}
                    {% else %}
                      {{ resourceType.tenantsNonCompliant }}
                    {% endif %}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          {% else %}
            <p class="govuk-body">Unable to load compliance overview data.</p>
          {% endif %}
        </div>
      </div>
    </main>
  </div>
{% endblock %}
