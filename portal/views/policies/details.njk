{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/input/macro.njk" import govukInput %}
{% from "govuk/components/pagination/macro.njk" import govukPagination %}
{% from "govuk/components/select/macro.njk" import govukSelect %}
{% extends "policies/policy.njk" %}
{% block policy_content %}
<details class="govuk-details" data-module="govuk-details">
    <summary class="govuk-details__summary">Filter Options</summary>
    <form method="get" class="govuk-form">
        {% for queryParam in queryParams %}<input aria-hidden type="hidden" name="{{queryParam.key}}" value="{{queryParam.value}}">{% endfor %}
        {{ govukInput({
            inputmode: "search",
            label: { text: "Search"},
            name: "search",
            value: queryParams["search"]
        }) }}
        {% for field in filterable_fields %}
        {{ govukSelect({
            label: { text: field.name },
            id: field.id,
            name: field.name,
            items: field.items
        }) }}
        {% endfor %}
        <div class="govuk-button-group">
            {{ govukButton({ text: "Filter" }) }}
            <a class="govuk-link" href="{{ url }}">Clear</a>
        </div>
    </form>
</details>

<table class="govuk-table">
    <thead class="govuk-table__head">
        <tr class="govuk-table__row">
            <th class="govuk-table__header">Resource</th>
            {% for field in prominent_fields %}<th class="govuk-table__header">{{field}}</th>{% endfor %}
            <th class="govuk-table__header" style="width: 100px;"></th>
        </tr>
    </thead>
    <tbody class="govuk-table__body">
        {% for resource in resources %}
            <tr class="govuk-table__row">
                <td class="govuk-table__cell">
                    <details class="govuk-details govuk-!-margin-bottom-0" data-module="govuk-details">
                        <summary class="govuk-details__summary">
                            <span class="govuk-details__summary-text">{{ resource[id_field] }}</span>
                        </summary>
                        <table class="govuk-details__text govuk-table govuk-!-margin-bottom-0 govuk-!-margin-top-2">
                            <tbody class="govuk-table__body">
                                <tr class="govuk-table__row">
                                    <td class="govuk-table__cell govuk-!-padding-left-2"><strong>Resource ID</strong></td>
                                    <td class="govuk-table__cell govuk-!-padding-left-2">{{ resource[id_field] }}</td>
                                </tr>
                                {% for field in details_fields %}
                                <tr class="govuk-table__row">
                                    <td class="govuk-table__cell govuk-!-padding-left-2"><strong>{{ field }}</strong></td>
                                    <td class="govuk-table__cell govuk-!-padding-left-2">{{ resource[field] }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </details>
                </td>
                {% for field in prominent_fields %}<td class="govuk-table__cell">{{ resource[field] }}</td>{% endfor %}
                <td class="govuk-table__cell govuk-!-padding-bottom-1 govuk-!-padding-top-1">
                    <button class="govuk-button govuk-button--secondary govuk-!-margin-bottom-0" onclick="navigator.clipboard.writeText('{{ resource[id_field] }}')" title="Copy ID">Copy ID</button>
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% if showPagination %}{{ govukPagination(pagination) }}{% endif %}
{% endblock %}
